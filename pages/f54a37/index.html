<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>锁-事物</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="这都能别你看到！">
    
    <link rel="preload" href="/assets/css/0.styles.207586fd.css" as="style"><link rel="preload" href="/assets/js/app.98d20b3f.js" as="script"><link rel="preload" href="/assets/js/2.869fa79d.js" as="script"><link rel="preload" href="/assets/js/21.bd89a370.js" as="script"><link rel="prefetch" href="/assets/js/10.28e4170c.js"><link rel="prefetch" href="/assets/js/11.817e0619.js"><link rel="prefetch" href="/assets/js/12.a82aae2a.js"><link rel="prefetch" href="/assets/js/13.82b8da78.js"><link rel="prefetch" href="/assets/js/14.f8f102e1.js"><link rel="prefetch" href="/assets/js/15.e8bf6d93.js"><link rel="prefetch" href="/assets/js/16.9bb3afab.js"><link rel="prefetch" href="/assets/js/17.59f3103a.js"><link rel="prefetch" href="/assets/js/18.06441a97.js"><link rel="prefetch" href="/assets/js/19.31ae385d.js"><link rel="prefetch" href="/assets/js/20.9011a7e6.js"><link rel="prefetch" href="/assets/js/22.87ac478c.js"><link rel="prefetch" href="/assets/js/23.3c64c06b.js"><link rel="prefetch" href="/assets/js/24.19c41544.js"><link rel="prefetch" href="/assets/js/25.4322d2aa.js"><link rel="prefetch" href="/assets/js/26.cfccd3d6.js"><link rel="prefetch" href="/assets/js/27.dbda8246.js"><link rel="prefetch" href="/assets/js/28.79ed3dfa.js"><link rel="prefetch" href="/assets/js/29.bb263129.js"><link rel="prefetch" href="/assets/js/3.5283630f.js"><link rel="prefetch" href="/assets/js/30.fbb6834a.js"><link rel="prefetch" href="/assets/js/31.40b35657.js"><link rel="prefetch" href="/assets/js/32.ca16d268.js"><link rel="prefetch" href="/assets/js/33.f7946037.js"><link rel="prefetch" href="/assets/js/34.fdf25b59.js"><link rel="prefetch" href="/assets/js/35.e59df783.js"><link rel="prefetch" href="/assets/js/36.f719d947.js"><link rel="prefetch" href="/assets/js/37.f7ffce81.js"><link rel="prefetch" href="/assets/js/38.1bcbbfbc.js"><link rel="prefetch" href="/assets/js/39.6058876d.js"><link rel="prefetch" href="/assets/js/4.178067f8.js"><link rel="prefetch" href="/assets/js/5.e770adf9.js"><link rel="prefetch" href="/assets/js/6.b48b33bd.js"><link rel="prefetch" href="/assets/js/7.7022f113.js"><link rel="prefetch" href="/assets/js/8.11a349d9.js"><link rel="prefetch" href="/assets/js/9.8c22faf0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.207586fd.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="碎碎念" class="dropdown-title"><a href="/coding/" class="link-title">碎碎念</a> <span class="title" style="display:none;">碎碎念</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/baodian/high/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="爱编程" class="dropdown-title"><a href="/coding/" class="link-title">爱编程</a> <span class="title" style="display:none;">爱编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/pat/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/coding/offer/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/coding/leeCode/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><a href="/column/" class="link-title">专栏</a> <span class="title" style="display:none;">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/column/synology/" class="nav-link">群晖NAS Docker系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/vuepress/" class="nav-link">vuepress系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/springboot/" class="nav-link">springboot系列教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><!----> <span class="title" style="display:;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Mysql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://mysql.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://mysql.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-MySql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://redis.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://redis.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>ElasticSearch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://www.jinglisen.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="碎碎念" class="dropdown-title"><a href="/coding/" class="link-title">碎碎念</a> <span class="title" style="display:none;">碎碎念</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/baodian/high/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="爱编程" class="dropdown-title"><a href="/coding/" class="link-title">爱编程</a> <span class="title" style="display:none;">爱编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/pat/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/coding/offer/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/coding/leeCode/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><a href="/column/" class="link-title">专栏</a> <span class="title" style="display:none;">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/column/synology/" class="nav-link">群晖NAS Docker系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/vuepress/" class="nav-link">vuepress系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/springboot/" class="nav-link">springboot系列教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><!----> <span class="title" style="display:;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Mysql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://mysql.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://mysql.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-MySql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://redis.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://redis.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>ElasticSearch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://www.jinglisen.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/linux/K8s部署文档" class="sidebar-heading clickable"><span>Linux</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/database/MyBatis-Plus-笔记" class="sidebar-heading clickable open"><span>数据库</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/701ae0/" class="sidebar-link">MyBatis-Plus-笔记</a></li><li><a href="/pages/ebd5af/" class="sidebar-link">MongoDB_学习笔记</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/database/ES/elasticsearch笔记" class="sidebar-heading clickable"><span>ES</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/database/mysql/MyBatis-Plus-笔记" class="sidebar-heading clickable open"><span>Mysql</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dc5ae6/" class="sidebar-link">Mybatisplus-整合Spring-Boot</a></li><li><a href="/pages/c9ba54/" class="sidebar-link">Mysql-MVCC初步了解</a></li><li><a href="/pages/cf4ab8/" class="sidebar-link">视图&amp;&amp;存储过程</a></li><li><a href="/pages/2781bc/" class="sidebar-link">常用sql</a></li><li><a href="/pages/f54a37/" aria-current="page" class="active sidebar-link">锁-事物</a></li><li><a href="/pages/8fe63c/" class="sidebar-link">索引</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/设计模式/学习笔记" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/调试工具/arthas/Arthas（阿尔萨斯）Java诊断工具_浅入了解" class="sidebar-heading clickable"><span>调试</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=database" title="分类" data-v-06225672>database</a></li><li data-v-06225672><a href="/categories/?category=mysql" title="分类" data-v-06225672>mysql</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">锁-事物<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="参考博客"><a href="#参考博客" class="header-anchor">#</a> 参考博客：</h1> <ul><li><a href="https://blog.csdn.net/SnailMann/article/details/94724197" target="_blank" rel="noopener noreferrer">正确的理解MySQL的MVCC及实现原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h1 id="mysql-锁-innodb"><a href="#mysql-锁-innodb" class="header-anchor">#</a> MySql 锁 - InnoDB</h1> <p>事物的隔离级别：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#查看当前的事物隔离级别</span>
<span class="token comment"># （mysql版本 8.0 以后）</span>
<span class="token keyword">select</span> @<span class="token variable">@transaction_isolation</span> 
<span class="token comment">#（mysql版本 8.0 之前）</span>
<span class="token keyword">select</span> @<span class="token variable">@tx_isolation</span>
<span class="token comment"># 查看版本号</span>
<span class="token keyword">select</span> @<span class="token variable">@version</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>读未提交：Read-Uncommitted</p> <blockquote><p>什么都不控制：脏读，幻读，重复读</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 设置隔离级别-读未提交</span>
<span class="token keyword">set</span> <span class="token keyword">session</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">read</span> <span class="token keyword">uncommitted</span><span class="token punctuation">;</span>
</code></pre></div></blockquote></li> <li><p>读已提交：Read-committed</p> <blockquote><p>解决脏读，其他事物未提交的数据不可读，会出现重复读，行锁。</p></blockquote></li> <li><p>可重复读：repadtable-read（<strong>Mysql默认级别</strong>）</p> <blockquote><p>解决可重复读了，引入间隙锁，防止其他事物在间隙插入数据导致两次范围查询结果不一样</p></blockquote></li> <li><p>串行化： Synchronize</p> <blockquote><p>串行化：所有的事物排队，一个一个的来执行，可解决幻读</p></blockquote></li></ul> <h1 id="宏观"><a href="#宏观" class="header-anchor">#</a> 宏观</h1> <h3 id="数据库锁"><a href="#数据库锁" class="header-anchor">#</a> 数据库锁</h3> <ul><li>粒度小，方便用于集群环境</li></ul> <h3 id="代码锁"><a href="#代码锁" class="header-anchor">#</a> 代码锁</h3> <ul><li>粒度大，需要封装</li></ul> <h1 id="微观"><a href="#微观" class="header-anchor">#</a> 微观</h1> <h2 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h2> <p>使用mysql测试锁的时候需要提前关闭事物的自动提交，步骤如下：</p> <ol><li><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查看是否开启自动提交</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'autocommit'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token operator">|</span> autocommit    <span class="token operator">|</span> <span class="token keyword">ON</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 关闭自动提交</span>
<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token keyword">ON</span><span class="token operator">|</span><span class="token keyword">OFF</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <h3 id="行锁-表锁"><a href="#行锁-表锁" class="header-anchor">#</a> 行锁&amp;表锁</h3> <p>只有明确指定主键，才会使用行锁，否则执行表锁</p> <ul><li><p>无锁</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 明确指定主键，但不存在该主键的值</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token keyword">for</span> <span class="token keyword">update</span>
</code></pre></div></li> <li><p>行锁</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 明确指定主键</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span>	 <span class="token keyword">user</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">01</span> <span class="token keyword">for</span> <span class="token keyword">update</span>
</code></pre></div></li> <li><p>表锁</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 主键不明确</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'jack'</span> <span class="token keyword">for</span> <span class="token keyword">update</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id <span class="token operator">like</span> <span class="token string">'3'</span> <span class="token keyword">for</span> <span class="token keyword">update</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id <span class="token operator">&lt;&gt;</span> <span class="token string">'3'</span> <span class="token keyword">for</span> <span class="token keyword">update</span>
</code></pre></div></li></ul> <h4 id="行锁算法"><a href="#行锁算法" class="header-anchor">#</a> 行锁算法</h4> <blockquote><p>Tips：默认RR隔离级别</p></blockquote> <h5 id="record-lock-普通行锁"><a href="#record-lock-普通行锁" class="header-anchor">#</a> Record Lock(普通行锁)</h5> <p>对于键值在条件范围内，且存在的记录，使用“Record Lock”, 普通行锁机制</p> <h5 id="gap-lock-间隙锁"><a href="#gap-lock-间隙锁" class="header-anchor">#</a> Gap Lock(间隙锁)</h5> <p>对于键值在条件范围内但并不存在的记录，叫做间隙锁，InnoDB会对这个间隙加锁，不包括记录本身</p> <ol><li><p>打开间隙锁设置</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查看是否禁用</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'innodb_locks_unsafe_for_binlog'</span><span class="token punctuation">;</span>
</code></pre></div><p>查看结果</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 默认打开</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+-------+</span>
<span class="token operator">|</span> Variable_name                  <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+-------+</span>
<span class="token operator">|</span> innodb_locks_unsafe_for_binlog <span class="token operator">|</span> <span class="token keyword">OFF</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------+-------+</span>
</code></pre></div></li> <li><p>修改间隙锁设置</p> <p>此参数是只读模式，如果想修改，需要修改配置文件m y.cnf(win是 m y.ini) 重新启动</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 在 my.cnf 里面的[mysqld]添加</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
innodb_locks_unsafe_for_binlog <span class="token operator">=</span> <span class="token number">1</span>
</code></pre></div></li></ol> <p>间隙索引的条件</p> <ul><li><p>使用普通索引锁定</p></li> <li><p>使用多列唯一索引</p></li> <li><p>使用唯一索引锁定多行记录</p> <h6 id="唯一索引的间隙锁"><a href="#唯一索引的间隙锁" class="header-anchor">#</a> 唯一索引的间隙锁</h6> <p>插入数据</p> <div class="language-s q l extra-class"><pre class="language-text"><code>INSERT INTO `test` VALUES ('1', '小罗');
INSERT INTO `test` VALUES ('5', '小黄');
INSERT INTO `test` VALUES ('7', '小明');
INSERT INTO `test` VALUES ('11', '小红');
</code></pre></div><p>查看间隙</p> <ol><li>(-infinity, 1]</li> <li>(1, 5]</li> <li>(5, 7]</li> <li>(7, 11]</li> <li>(11, +infinity]</li></ol> <p>开启一个事物操作</p> <div class="language-mysql extra-class"><pre class="language-text"><code>BEGIN;
/* 查询 id 在 7 - 11 范围的数据并加记录锁 */
SELECT * FROM `test` WHERE `id` BETWEEN 5 AND 7 FOR UPDATE;

# ------------------------------------------------------
/* 事务7插入一条 id = 11， name = '李西' 的数据 */
INSERT INTO `test` (`id`, `name`) VALUES (11, '李西'); # 阻塞

/* 事务4插入一条 id = 6，name = '小东' 的数据 */
INSERT INTO `test` (`id`, `name`) VALUES (6, '小东'); # 阻塞

/* 事务5插入一条 id = 8， name = '大罗' 的数据 */
INSERT INTO `test` (`id`, `name`) VALUES (8, '大罗'); # 阻塞

/* 事务6插入一条 id = 9， name = '大东' 的数据 */
INSERT INTO `test` (`id`, `name`) VALUES (9, '大东'); # 阻塞

</code></pre></div><blockquote><p>当我们给5到7这两个区间加锁的时候，会锁住 5-7    7-11这两个区间</p></blockquote></li></ul> <p>普通索引的间隙锁</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 1. 创建表</span>
<span class="token comment"># 注意：number 不是唯一值</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'数字'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>查看间隙</p> <ol><li>(-infinity, 1]</li> <li>(1, 3]</li> <li>(3, 8]</li> <li>(8, 12]</li> <li>(12, +infinity]</li></ol> <p>执行事物</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">/* 开启事务1 */</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token comment">/* 查询 number = 5 的数据并加记录锁 */</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
<span class="token comment">/* 延迟30秒执行，防止锁释放 */</span>
<span class="token keyword">SELECT</span> SLEEP<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 注意：以下的语句不是放在一个事务中执行，而是分开多次执行，每次事务中只有一条添加语句</span>

<span class="token comment">/* 事务2插入一条 number = 0 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 正常执行</span>

<span class="token comment">/* 事务3插入一条 number = 1 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 被阻塞</span>

<span class="token comment">/* 事务4插入一条 number = 2 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 被阻塞</span>

<span class="token comment">/* 事务5插入一条 number = 4 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 被阻塞</span>

<span class="token comment">/* 事务6插入一条 number = 8 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 正常执行</span>

<span class="token comment">/* 事务7插入一条 number = 9 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 正常执行</span>

<span class="token comment">/* 事务8插入一条 number = 10 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 正常执行</span>

<span class="token comment">/* 提交事务1 */</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>这里可以看到，number (1 - 8) 的间隙中，插入语句都被阻塞了，而不在这个范围内的语句，正常执行，这就是因为有间隙锁的原因。</p></blockquote> <p>继续测试 数据还原</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">/* 开启事务1 */</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token comment">/* 查询 number = 5 的数据并加记录锁 */</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span>
<span class="token comment">/* 延迟30秒执行，防止锁释放 */</span>
<span class="token keyword">SELECT</span> SLEEP<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 事务1插入一条 id = 2， number = 1 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 阻塞</span>

<span class="token comment">/* 事务2插入一条 id = 3， number = 2 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 阻塞</span>

<span class="token comment">/* 事务3插入一条 id = 6， number = 8 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 阻塞</span>

<span class="token comment">/* 事务4插入一条 id = 8， number = 8 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 正常执行</span>

<span class="token comment">/* 事务5插入一条 id = 9， number = 9 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 正常执行</span>

<span class="token comment">/* 事务6插入一条 id = 10， number = 12 的数据 */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 正常执行</span>

<span class="token comment">/* 事务7修改 id = 11， number = 12 的数据 */</span>
<span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">`</span>test1<span class="token punctuation">`</span></span> <span class="token keyword">SET</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">11</span> <span class="token operator">AND</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment"># 阻塞</span>

<span class="token comment">/* 提交事务1 */</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre></div><p>这里有一个奇怪的现象：</p> <ul><li>事务3添加 id = 6，number = 8 的数据，给阻塞了；</li> <li>事务4添加 id = 8，number = 8 的数据，正常执行了。</li> <li>事务7将 id = 11，number = 12 的数据修改为 id = 11， number = 5的操作，给阻塞了；</li></ul> <p>原因如下：</p> <p><img src="https://pic2.zhimg.com/80/v2-e5fe73d5f7fda8c298ce60fd35915885_720w.jpg" alt="img"></p> <p>从图中可以看出，当 number 相同时，会根据主键 id 来排序，所以：</p> <ol><li>事务3添加的 id = 6，number = 8，这条数据是在 （3, 8） 的区间里边，所以会被阻塞；</li> <li>事务4添加的 id = 8，number = 8，这条数据则是在（8, 12）区间里边，所以不会被阻塞；</li> <li>事务7的修改语句相当于在 （3, 8） 的区间里边插入一条数据，所以也被阻塞了。</li></ol> <p><strong>结论：</strong></p> <ol><li>在普通索引上，不管是何种查询，只要加锁，都会产生间隙锁，跟唯一索引不一样：</li> <li>在普通索引和唯一索引中，数据间隙的分析，是有限根据普通索引再根据唯一索引</li></ol> <h5 id="next-key-lock-行-间隙"><a href="#next-key-lock-行-间隙" class="header-anchor">#</a> Next-Key Lock ( 行&amp; 间隙)</h5> <p>对于给存在和不存在的数据同时加锁，则称为Next-key Lock，InnoDb在扫描记录的时候，会首先对索引记录加上行锁，然后对索引的两边加上间隙锁。作用在于防止其他事物在这个间隙插入或者修改数据，防止幻读。</p> <h4 id="表锁算法"><a href="#表锁算法" class="header-anchor">#</a> 表锁算法</h4> <ol><li><p><strong>意向锁</strong></p> <p>当一个事物带着表锁去访问一个被加了行锁的资源，那么，这个行锁会升级为表锁，将表锁住。常用的意向锁有共享意向锁，意象派他锁，共享意向派他锁。</p> <p>道理如下：</p> <ol><li>当一个事物锁住了一行的时候，让这一行只能读不能写</li> <li>另外一个事物尝试获取表锁，如果申请成功，将获取整个表的读取权限，和第一个事物的行锁是有冲突的。</li></ol> <p><strong>意向锁为啥子存在</strong></p> <p>在正常情况下事物二想去获取表锁，先判断表锁是否存在，然后判断每一行是否有锁。效率低下。所以存在意象锁。</p> <p>如果在有意向锁的情况下，事物一必须先申请意向共享锁，然后申请行锁，事物二在步骤二的时候发现表上有意向锁就等待</p> <blockquote><p>申请意向锁的操作是数据库来完成的，事物在申请行锁的时候数据库会自动申请表的意向锁</p></blockquote></li> <li><p><strong>自增锁</strong></p> <p>事物插入自增类型的列时获取自增锁，其他的事物插入必须等待。5.1.22之后。自增锁的设置</p> <ul><li>innodb_autoinc_lock_mode: 0|1|2
<ul><li>0: traditonal,每次都会产生表锁，性能垃圾，申请到自增锁之后要语句完成才释放</li> <li>1:consecutive 会产生一个轻量的锁，连续插入，在申请到自增锁之后释放自增锁。</li> <li>2:interleaved 交错方式，多语句插入时，一次分配一批自增值，顺序不一致，性能高</li></ul></li></ul> <blockquote><p>默认是第二种。mysql真贴心</p></blockquote> <p><strong>表锁和行锁是锁粒度的概念，具体还要看下面的实现</strong></p></li></ol> <h1 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h1> <h2 id="共享锁-排它锁"><a href="#共享锁-排它锁" class="header-anchor">#</a> 共享锁&amp;排它锁</h2> <blockquote><p>表锁和行锁是锁粒度的概念，共享锁和排它锁是他们的具体实现</p></blockquote> <h3 id="共享锁-s-读锁"><a href="#共享锁-s-读锁" class="header-anchor">#</a> 共享锁（S）:读锁</h3> <ul><li><p>允许一个事物去读一行，阻止其他事物获取该行的排它锁</p></li> <li><p>多事物的时候只能加共享读锁，不能加排它锁，单事物的时候可以加任何锁</p></li> <li><p>总结：能读不能写</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token keyword">lock</span> <span class="token operator">in</span> <span class="token keyword">share</span> <span class="token keyword">mode</span>
<span class="token comment"># mysql8.0之后，使用FOR SHARE 代替LOCK IN SHARE MODE ,两者是等价的，但是FOR SHARE 支持NOWAIT,SKIP LOCKED 等，配合自旋，可以实现高效的等待队列</span>
</code></pre></div></li></ul> <h3 id="排它锁-x-写锁"><a href="#排它锁-x-写锁" class="header-anchor">#</a> 排它锁（X）:写锁</h3> <ul><li><p>允许持有排它锁的事物读写数据，阻止其他事物获取该数据的共享锁和排它锁</p></li> <li><p>其他事物不能获取该数据的任何锁，直到排它锁释放</p></li> <li><p>不能获取任何锁不代表不能无锁读区</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">*</span> <span class="token keyword">update</span>
<span class="token operator">*</span> <span class="token keyword">Insert</span> 
<span class="token operator">*</span> <span class="token keyword">Delete</span> 
<span class="token operator">*</span> <span class="token keyword">Select</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">for</span> <span class="token keyword">update</span>
</code></pre></div></li></ul> <h3 id="tips"><a href="#tips" class="header-anchor">#</a> Tips:</h3> <p>排它锁指的是，在某个事物获取数据的排它锁之后，其他事物不能获取该数据的任何锁，但是不代表其他事物不能无锁获取该数据</p> <ul><li>无锁
<ul><li>select ... from</li></ul></li></ul> <h2 id="乐观锁-悲观锁"><a href="#乐观锁-悲观锁" class="header-anchor">#</a> 乐观锁&amp;悲观锁</h2> <blockquote><p>不管什么锁都需要增加操作失败重试</p></blockquote> <h3 id="乐观锁"><a href="#乐观锁" class="header-anchor">#</a> 乐观锁</h3> <ul><li><p>通过版本号来进行更新的操作属于乐观锁</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> tab <span class="token keyword">set</span> name <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>version <span class="token operator">=</span> version<span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">and</span> version <span class="token operator">=</span> xxx
</code></pre></div></li></ul> <h3 id="悲观锁"><a href="#悲观锁" class="header-anchor">#</a> 悲观锁</h3> <blockquote><p>共享锁和排它锁都是悲观锁的具体实现</p></blockquote> <ul><li>显示的控制行锁或表锁属于悲观锁</li></ul> <h1 id="mvcc"><a href="#mvcc" class="header-anchor">#</a> MVCC</h1> <p>MVCC   全称<strong>Multi-Version Concurrency Control</strong> , 即多版本并发控制。是一种并发控制的办法。</p> <p>在Mysql InnoDB中的实现主要是为了提高数据库的并发性能。更好的处理读写的性能。即使有读写冲突时，也能做到到不加锁，非阻塞并发读</p> <h2 id="当前读和快照读"><a href="#当前读和快照读" class="header-anchor">#</a> 当前读和快照读</h2> <p>了解多版本并发控制之前先了解当前读和快照读</p> <ul><li><p>当前读</p> <p>像 <strong>select .. for share</strong> 这些锁操作都是当前读，读取的是数据库的最新版本，读取的时候还需要保证其他事物不能修改当前记录，加锁。</p></li> <li><p>快照读</p> <p>像 <strong>select ...</strong> 这种不加锁的都是快照读，即不加锁的非阻塞读，前提是隔离级别不是串行化。在串行化下快照读会退化。快照读的实现是基于MVCC来实现的，在很多情况下避免了加锁的操作，降低了开销。多版本吗，那读到的有可能不是最新版本的数据，而是之前的旧版本的数据。</p> <blockquote><p>简单理解，为了实现读-写冲突不加锁，将数据生成一个快照，非锁读的就是快照版本。</p></blockquote></li></ul> <h2 id="mvcc的实现"><a href="#mvcc的实现" class="header-anchor">#</a> MVCC的实现</h2> <p>MVCC仅仅是一个维持数据多版本的概念。想实现这么个概念，需要mysql具体去实现它。快照读就是mysql的具体实现，快照读本身是一个抽象概念，而在Mysql中具体是由，<strong>三个隐藏字段</strong>，<strong>undo-日志</strong> ，<strong>Read View</strong> 来实现的。</p> <ol><li><p>隐藏字段</p> <p>每行记录除了我们自定义的字段外，还有数据库隐藏定义的DB_TRX_ID,DB_ROLL_PTR,DB_ROW_id字段</p> <ul><li><p>DB_TRX_ID</p> <p>6byte,最近修改事物ID：记录创建或者最后一次修改该记录的事物ID</p></li> <li><p>BD_ROLL_PTR</p> <p>7byte,回滚指针，指向这条记录的上一个版本，（rollback segment存储）</p></li> <li><p>DB_ROW_ID</p> <p>6byte,隐藏的自增ID,如果数据表没有主见，会自动以DB_ROW_id 产生一个聚簇索引</p></li></ul> <blockquote><p>实际上还有一个删除flag隐藏字段，更新或删除的时候flag变了而不是真正的删除。</p></blockquote></li> <li><p>Undo 日志</p> <p>Undo日志主要分为两种：</p> <ul><li><p>insert undo log</p> <p>代表事物在插入的时候产生的undo log,在事物回归的时候需要，提交后可以被立即丢弃的</p></li> <li><p>update undo log</p> <p>事物在进行修改或者删除的undo log ,不仅在回滚的时候需要，快照读的时候也需要，不能随便删除，只有在快照读或事物回滚不涉及到该日志时，才会被purge线程统一清楚</p> <blockquote><p>Purge</p> <ul><li>从前面的分析，为了实现InnoDB的MVCC机制，更新或者操作的时候知识设置了一下老记录的deleted_bit。并不真正的删除</li> <li>为了节省资盘空间，InnoDB有专门的purge线程来清理deleted_bit=true的数据，它自己维护了一个Read view,如果某个记录的值为true,并且隐藏的事物ID对线程可见，那么就可以被安全的删除</li></ul></blockquote></li></ul> <p>对MVCC有帮助的实质是<code>update undo log</code> ，<code>undo log</code>实际上就是存在<code>rollback segment</code>中旧记录链，<strong>它的执行流程如下：</strong></p> <ol><li><strong>比如一个有个事务插入persion表插入了一条新记录，记录如下，<code>name</code>为Jerry, <code>age</code>为24岁，<code>隐式主键</code>是1，<code>事务ID</code>和<code>回滚指针</code>，我们假设为NULL</strong></li></ol> <p><img src="https://img-blog.csdnimg.cn/20190313213836406.png" alt="img"></p> <ol start="2"><li><strong>现在来了一个<code>事务1</code>对该记录的<code>name</code>做出了修改，改为Tom</strong></li></ol> <ul><li>在<code>事务1</code>修改该行(记录)数据时，数据库会先对该行加<code>排他锁</code></li> <li>然后把该行数据拷贝到<code>undo log</code>中，作为旧记录，既在<code>undo log</code>中有当前行的拷贝副本</li> <li>拷贝完毕后，修改该行<code>name</code>为Tom，并且修改隐藏字段的事务ID为当前<code>事务1</code>的ID, 我们默认从<code>1</code>开始，之后递增，回滚指针指向拷贝到<code>undo log</code>的副本记录，既表示我的上一个版本就是它</li> <li>事务提交后，释放锁</li></ul> <p><img src="https://img-blog.csdnimg.cn/20190313220441831.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NuYWlsTWFubg==,size_16,color_FFFFFF,t_70" alt="img"></p> <ol start="3"><li><p><strong>又来了个<code>事务2</code>修改<code>person表</code>的同一个记录，将<code>age</code>修改为30岁</strong></p> <ul><li><p>在<code>事务2</code>修改该行数据时，数据库也先为该行加锁</p></li> <li><p>然后把该行数据拷贝到<code>undo log</code>中，作为旧记录，发现该行记录已经有<code>undo log</code>了，那么最新的旧数据作为链表的表头，插在该行记录的<code>undo log</code>最前面</p></li> <li><p>修改该行<code>age</code>为30岁，并且修改隐藏字段的事务ID为当前<code>事务2</code>的ID, 那就是<code>2</code>，回滚指针指向刚刚拷贝到<code>undo log</code>的副本记录</p></li> <li><p>事务提交，释放锁</p> <p><img src="https://img-blog.csdnimg.cn/20190313220528630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NuYWlsTWFubg==,size_16,color_FFFFFF,t_70" alt="img"></p> <blockquote><p>从上面，我们就可以看出，不同事务或者相同事务的对同一记录的修改，会导致该记录的undo log成为一条记录版本线性表，既链表，undo log的链首就是最新的旧记录，链尾就是最早的旧记录（当然就像之前说的该undo log的节点可能是会purge线程清除掉，向图中的第一条insert undo log，其实在事务提交之后可能就被删除丢失了，不过这里为了演示，所以还放在这里）</p></blockquote></li></ul></li></ol></li> <li><p>Read View (读视图)</p> <p>Read View 事物进行快照读的时候生产的读视图。在该事物执行的快照读的那一刻，会生成数据库系统当前的一个快照，记录并维护系统当前活跃事物的ID， ID是递增的。</p> <p>Read View主要是用来做可见性判断的，主要是将数据的最新纪录中的DB_TRX_ID(当前事物ID)取出来，与系统其他的活跃事物ID做比较，如果DB_TRX_id跟Read View的属性做了某些比较，不符合可见性，那就通过DB_ROLL_PTR回滚指针去取出undo log中的数据事物Id做比较，头到尾，知道找到满足条件的事物ID，那么这个事物ID锁存在的数据就是能看见的最新<code>老版本</code></p></li></ol> <h1 id="事物"><a href="#事物" class="header-anchor">#</a> 事物</h1> <p>事物只是一个改变，是一些操作的集合。从程序的角度讲就是一个执行单元。事物中常常讲到四个特性，其实事物本身并不包含这四个特性，而是我们通过一些手段，尽可能的让这个执行单元满足这四个特性，那么他就是一个完美的事物。</p> <h2 id="_1-四特性"><a href="#_1-四特性" class="header-anchor">#</a> 1. 四特性</h2> <ul><li><p>原子性：</p> <p>满足原子操作单元，对数据的操作，要么全部执行，要么全部失败</p></li> <li><p>一致性：</p> <p>事物的开始和完成，数据都必须保持一致</p></li> <li><p>隔离性：</p> <p>事物之间是对立的，中间状态对外是不可见的</p></li> <li><p>永久性：</p> <p>数据的修改是永久的</p></li></ul> <h2 id="_2-隔离级别"><a href="#_2-隔离级别" class="header-anchor">#</a> 2. 隔离级别</h2> <p>并发情况下事物引发的问题</p> <blockquote><p>一般情况下，多个单元操作并发执行，会出现一下问题：</p></blockquote> <ul><li>脏读：一个事物读取到另一个事物还没有提交的结果 （破坏了隔离性）</li> <li>不可重复读：A事物在本次事物中，对自己未操作的数据，进行了多次查询，结果出现了不一致，或数据不存在的情况，破坏了一致性，update,delete</li> <li>幻读：A事物在本次事物中，对自己未操作的数据，进行了多次查询，结果出现了不一致，第一次查询的时候纪录不存在，第二次查询的时候纪录出现了</li></ul> <p>为了权衡隔离和并发的矛盾，ISO制定了这四个隔离级别，每个隔离级别不同，允许出现的副作用也不同</p> <ul><li>Read-uncommitted（未提交读）：最低级别，只能保证持久性</li> <li>Read-committed (已提交读)：语句级别，不会出现脏读</li> <li>Repeatable-read(可重复读)：事物级别，解决不可重复读问题</li> <li>Serializable(串行化)：最高级别，完全串行化执行，毫无并发可言。解决幻读</li></ul> <h2 id="_3-实现-innodb"><a href="#_3-实现-innodb" class="header-anchor">#</a> 3. 实现（InnoDB）</h2> <ul><li>锁机制：阻止其他事物对数据进行操作，每个隔离级别主要体现在加锁和释放锁的时机不同
<ul><li>Ru： 读取的时候不加锁</li> <li>Rc：读取的时候加行级共享锁，读到数据才加锁，一旦读完立马释放，并不是事物结束</li> <li>RR： 行级共享锁，事物结束才会释放</li> <li>SE： 加表锁，事物结束才会释放。</li></ul></li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/2781bc/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">常用sql</div></a> <a href="/pages/8fe63c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">索引</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/2781bc/" class="prev">常用sql</a></span> <span class="next"><a href="/pages/8fe63c/">索引</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/4e0768/"><div>
            Swagger接入YApi
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ceaa10/"><div>
            Docker_学习笔记2
            <!----></div></a> <span class="date">05-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/7bf273/"><div>
            压缩网络图片并下载
            <!----></div></a> <span class="date">05-31</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.98d20b3f.js" defer></script><script src="/assets/js/2.869fa79d.js" defer></script><script src="/assets/js/21.bd89a370.js" defer></script>
  </body>
</html>
