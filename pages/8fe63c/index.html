<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>索引</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="这都能别你看到！">
    
    <link rel="preload" href="/assets/css/0.styles.207586fd.css" as="style"><link rel="preload" href="/assets/js/app.98d20b3f.js" as="script"><link rel="preload" href="/assets/js/2.869fa79d.js" as="script"><link rel="preload" href="/assets/js/19.31ae385d.js" as="script"><link rel="prefetch" href="/assets/js/10.28e4170c.js"><link rel="prefetch" href="/assets/js/11.817e0619.js"><link rel="prefetch" href="/assets/js/12.a82aae2a.js"><link rel="prefetch" href="/assets/js/13.82b8da78.js"><link rel="prefetch" href="/assets/js/14.f8f102e1.js"><link rel="prefetch" href="/assets/js/15.e8bf6d93.js"><link rel="prefetch" href="/assets/js/16.9bb3afab.js"><link rel="prefetch" href="/assets/js/17.59f3103a.js"><link rel="prefetch" href="/assets/js/18.06441a97.js"><link rel="prefetch" href="/assets/js/20.9011a7e6.js"><link rel="prefetch" href="/assets/js/21.bd89a370.js"><link rel="prefetch" href="/assets/js/22.87ac478c.js"><link rel="prefetch" href="/assets/js/23.3c64c06b.js"><link rel="prefetch" href="/assets/js/24.19c41544.js"><link rel="prefetch" href="/assets/js/25.4322d2aa.js"><link rel="prefetch" href="/assets/js/26.cfccd3d6.js"><link rel="prefetch" href="/assets/js/27.dbda8246.js"><link rel="prefetch" href="/assets/js/28.79ed3dfa.js"><link rel="prefetch" href="/assets/js/29.bb263129.js"><link rel="prefetch" href="/assets/js/3.5283630f.js"><link rel="prefetch" href="/assets/js/30.fbb6834a.js"><link rel="prefetch" href="/assets/js/31.40b35657.js"><link rel="prefetch" href="/assets/js/32.ca16d268.js"><link rel="prefetch" href="/assets/js/33.f7946037.js"><link rel="prefetch" href="/assets/js/34.fdf25b59.js"><link rel="prefetch" href="/assets/js/35.e59df783.js"><link rel="prefetch" href="/assets/js/36.f719d947.js"><link rel="prefetch" href="/assets/js/37.f7ffce81.js"><link rel="prefetch" href="/assets/js/38.1bcbbfbc.js"><link rel="prefetch" href="/assets/js/39.6058876d.js"><link rel="prefetch" href="/assets/js/4.178067f8.js"><link rel="prefetch" href="/assets/js/5.e770adf9.js"><link rel="prefetch" href="/assets/js/6.b48b33bd.js"><link rel="prefetch" href="/assets/js/7.7022f113.js"><link rel="prefetch" href="/assets/js/8.11a349d9.js"><link rel="prefetch" href="/assets/js/9.8c22faf0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.207586fd.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="碎碎念" class="dropdown-title"><a href="/coding/" class="link-title">碎碎念</a> <span class="title" style="display:none;">碎碎念</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/baodian/high/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="爱编程" class="dropdown-title"><a href="/coding/" class="link-title">爱编程</a> <span class="title" style="display:none;">爱编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/pat/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/coding/offer/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/coding/leeCode/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><a href="/column/" class="link-title">专栏</a> <span class="title" style="display:none;">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/column/synology/" class="nav-link">群晖NAS Docker系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/vuepress/" class="nav-link">vuepress系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/springboot/" class="nav-link">springboot系列教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><!----> <span class="title" style="display:;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Mysql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://mysql.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://mysql.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-MySql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://redis.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://redis.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>ElasticSearch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://www.jinglisen.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="碎碎念" class="dropdown-title"><a href="/coding/" class="link-title">碎碎念</a> <span class="title" style="display:none;">碎碎念</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/baodian/zero/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/baodian/high/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="爱编程" class="dropdown-title"><a href="/coding/" class="link-title">爱编程</a> <span class="title" style="display:none;">爱编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/pat/" class="nav-link">PAT</a></li><li class="dropdown-item"><!----> <a href="/coding/offer/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/coding/leeCode/" class="nav-link">LeeCode</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><a href="/column/" class="link-title">专栏</a> <span class="title" style="display:none;">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/column/synology/" class="nav-link">群晖NAS Docker系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/vuepress/" class="nav-link">vuepress系列教程</a></li><li class="dropdown-item"><!----> <a href="/column/springboot/" class="nav-link">springboot系列教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><!----> <span class="title" style="display:;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Mysql</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://mysql.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Mysql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://mysql.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-MySql
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>Redis</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://redis.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://redis.huerpu.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-Redis
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>ElasticSearch</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS918-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://es.hepcloud.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DS220-es
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://www.jinglisen.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/linux/K8s部署文档" class="sidebar-heading clickable"><span>Linux</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/database/MyBatis-Plus-笔记" class="sidebar-heading clickable open"><span>数据库</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/701ae0/" class="sidebar-link">MyBatis-Plus-笔记</a></li><li><a href="/pages/ebd5af/" class="sidebar-link">MongoDB_学习笔记</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/database/ES/elasticsearch笔记" class="sidebar-heading clickable"><span>ES</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/database/mysql/MyBatis-Plus-笔记" class="sidebar-heading clickable open"><span>Mysql</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dc5ae6/" class="sidebar-link">Mybatisplus-整合Spring-Boot</a></li><li><a href="/pages/c9ba54/" class="sidebar-link">Mysql-MVCC初步了解</a></li><li><a href="/pages/cf4ab8/" class="sidebar-link">视图&amp;&amp;存储过程</a></li><li><a href="/pages/2781bc/" class="sidebar-link">常用sql</a></li><li><a href="/pages/f54a37/" class="sidebar-link">锁-事物</a></li><li><a href="/pages/8fe63c/" aria-current="page" class="active sidebar-link">索引</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/设计模式/学习笔记" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/调试工具/arthas/Arthas（阿尔萨斯）Java诊断工具_浅入了解" class="sidebar-heading clickable"><span>调试</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=database" title="分类" data-v-06225672>database</a></li><li data-v-06225672><a href="/categories/?category=mysql" title="分类" data-v-06225672>mysql</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">索引<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="_1-mysql-索引"><a href="#_1-mysql-索引" class="header-anchor">#</a> 1. MySql-索引</h1> <p>Mysql的索引类似于字典的目录，用于快速查找具有特定列值的行。如果没有索引的话，查找数据需要一行一行的找下去，这个时候表越大，花费的时间就越大。索引分为单列索引和组合索引。</p> <p>索引也是一张表，该表保存了主键和索引字段，并指向索引表的记录。</p> <ul><li><p>innoDB最多创建1017列，最多64个二级索引，单个索引最多包含16列，索引的最大长度为767字节</p> <blockquote><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-limits.html" target="_blank" rel="noopener noreferrer">innoDB限制的官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li></ul> <p>表的物理存储：</p> <ul><li>MyISAM</li> <li><ul><li>.frm文件：与表相关的元数据信息都存放在fr m文件，包括表的结构定义信息，在数据库名目录下</li> <li>.myd文件：引擎独有，存储表的数据</li> <li>.myi文件：独有，索引相关的信息</li></ul></li> <li>InnoDB</li> <li><ul><li>.frm文件：与表相关的元数据信息都存放在fr m文件，包括表的结构定义信息，在数据库名目录下</li> <li>ibd/ibdata:都是用来存储数据和索引的，之所以有两个是因为InnoDB是可以通过配置文件来决定存储方式，ibd存储单个表数据或者ibdata存储所有表的数据。又叫独享表空间，共享表空间</li></ul></li></ul> <p>索引并不是越多越好，innoDB官方也对这方面做了限制，过多的建造索引虽然会增加查询速度，同时也会降低插入和更新数据的速度，mysql不仅要保存数据，还需要保存索引文件。</p> <h1 id="_2-索引的原理"><a href="#_2-索引的原理" class="header-anchor">#</a> 2. 索引的原理</h1> <h2 id="_2-1索引的原理"><a href="#_2-1索引的原理" class="header-anchor">#</a> 2.1索引的原理</h2> <p>所以的目的在于提高查询效率，与我们查书的目录是一个道理，先定位到章，在定位到页。书的目录也是需要占用页数的，同理索引页也是要存到磁盘空间的。那么索引插入的时机也是有关系的，在数据少的时候插入索引肯定比数据多的时候插入的快，所以在表设计之初就要想好要建立那些索引</p> <p>mysql索引的本质就是通过不断的缩小查找范围来筛选出最终的结果（二分查找）。同时把随机的事件变为顺序的事件，就是每次都可以用同样的顺序来查找数据。</p> <p><strong>二分查找：</strong></p> <ul><li>二分查找的原理就是通过不断的分批查找，最简单的如果1000条数据，1到100分成第一段，101到200分成第二段，201到300分成第三段......这样查第250条数据，只要找第三段就可以了，一下子去除了90%的无效数据。</li></ul> <p>搜索树，平均复杂度是lgN。具有不错的查询性能，但是数据库的情况比较复杂，一方面数据是保存在磁盘上的，另一方面为了提高性能，每次需要把数据读到内存中来计算。访问磁盘是非常消耗资源的，所以简单的搜索树很难满足复杂的应用场景。</p> <h2 id="_2-2-磁盘io与预读"><a href="#_2-2-磁盘io与预读" class="header-anchor">#</a> 2.2 磁盘IO与预读</h2> <p>磁盘读取数据靠的是机械运动，就转圈吗。一次磁盘IO的时间大约是9ms。但是一台普通的机器每秒可以执行5亿条指令，因为指令中依靠的是电的性质。相当于一次磁盘IO CPU可以执行500万条指令。所以磁盘IO是非常高昂的操作，所以计算机系统做了一些优化，当一次IO的时候，不光读取当前磁盘地址的数据，还把相邻地址的数据读取出来。一次IO读取的数据可以称为一页。</p> <h2 id="_2-3-索引的数据结构"><a href="#_2-3-索引的数据结构" class="header-anchor">#</a> 2.3 索引的数据结构</h2> <p>索引的目的就是减少磁盘的IO，加速查询速度。mysql-innoDB使用的<code>B+树</code>结构来实现的，<code>B+树</code>是一个高度可控的多路搜索树（通过二叉查找树，再由平衡二叉树，B树演化而来）</p> <p><img src="https://img2018.cnblogs.com/blog/1730003/201909/1730003-20190904153244905-527142719.png" alt="img"></p> <ul><li><p><strong>B+树的查找过程：</strong></p> <blockquote><p>如果查找数据29的话查询的步骤如下</p></blockquote> <ul><li>从磁盘中读取磁盘块1到内存中，发生第一次磁盘IO。然后使用二分查找发现29在17到35之间，那么确定数据在P2的磁盘块下。</li> <li>从磁盘中读取磁盘快3到内存中，发生第二次磁盘IO。然后使用二分查找发现29在26到30之间，那么确定数据在P2的磁盘块下。</li> <li>这时发生第三次IO加载磁盘块8，并使用二分查找找到结果，</li></ul> <blockquote><p>本次查询结果用使用三次磁盘IO,性能对于没有索引的动则百计的IO提升非常大。</p></blockquote></li> <li><p><strong>B+树的性质：</strong></p> <ul><li><p><strong>索引的字段要尽量的小</strong>：索引的IO次数取决于树的高低，因为每个数据块到根结点的距离是相同的。</p> <p>假设当前  数据表总数 = n ,每个磁盘块的 数据项的数量 = m , 则：</p> <p>$$
h=\log(m+1)n
$$
当数据量N不变的情况下，M越大，h越小。而M磁盘块的大小是固定的，一般默认是16KB,如果一个数据项占用的空间越小，数量就越多。树的高度就越低。这就是为什么B+树把数据放到叶子结点而不是内层节点，一般一个磁盘块至少有两条数据，当一个磁盘块的数据项等于一的时候将会退化为线性表。</p></li> <li><p><strong>索引的最左匹配特性</strong>：简单的说就是数据来了之后，从数据块的最左边开始匹配，然后匹配右边的。B+树的数据项是复合的数据结构，如果（name,age,sex）的时候顺序来建立搜索树的，在检索的时候也是同理，先比较name,name相同在一次比较age,sex。但是如果来查询a ge,sex这样的查询条件的话，索引就不知道从什么开始找，因为name是第一个比较因子。</p></li></ul></li></ul> <h1 id="_3-聚集索引-辅助索引"><a href="#_3-聚集索引-辅助索引" class="header-anchor">#</a> 3.聚集索引&amp;&amp;辅助索引</h1> <h2 id="_3-1-聚集索引"><a href="#_3-1-聚集索引" class="header-anchor">#</a> <strong>3.1 聚集索引</strong></h2> <p>指的就是数据表的主键，innoDB存储引擎存储数据的时候必须要有一个主键，如果没有设置主键会选择一个不包含null的唯一索引当主键。如果还没有会使用行号生成一个隐藏主键。InnoDB的索引文件放在.idb文件里面，InnoDB存储引擎在存储数据的时候默认就是按照索引的树形结构来存储数据的，所以这种索引称之为聚集索引，就是说是在聚集数据组织数据的时候用的索引。</p> <p>在数据库中，B+树的高度一般为2-4层，以为这查询一次只需要0.02到0.04秒</p> <p>InnoDB存储引擎表示索引组织表，即表中的数据按照主键顺序排放，聚集索引就是按照每张表的主键构件一颗B+树。数据存放在叶子结点，称为数据页，并且每个数据页都是通过双向链表链接起来的。</p> <p>范围查询：如果想要找到某一范围的数据，通过叶子节点的上层中间节点就可以得到页的范围，可以快速读取到数据也。</p> <h2 id="_3-2-辅助索引"><a href="#_3-2-辅助索引" class="header-anchor">#</a> 3.2 辅助索引</h2> <p>表的主键是聚集索引，但是实际使用中往往需要通过其他字段来查询数据，比如name 这个时候就需要用到辅助索引，表中除了聚集索引其他的都是辅助索引。</p> <p><strong>概念：</strong></p> <ul><li><strong>覆盖索引</strong>： 辅助索引和聚集索引不同，辅助索引的叶子节点存放的该索引的值，是一个键值对，除了键值对还有一个bookmark（书签). 可以理解为一个{'name字段'，name的值，主键id值}，如果你要查找的数据只有name 那么直接在叶子节点上找到对应的值就行。这样称之为覆盖索引。</li> <li><strong>回表</strong>：同上，如果你想通过name查找这个人的年纪，此时该索引的叶子节点只存储了name的值和该条数据的主键值，那么会取出主键的值再通过聚集索引来查处该条数据的其他值。这种方式称为<code>回表查询</code></li></ul> <p><strong>实现：</strong></p> <p>索引的功能就是加快速度查找，但是有一些所以除来加快查询外还有约束的功能。</p> <ul><li><strong>普通索引</strong> <ul><li>Index: 加速查找</li></ul></li> <li><strong>唯一索引</strong> <ul><li>primary:主键索引，不能重复，不能为空</li> <li>u nique:唯一索引，不能重复，可以为空</li></ul></li> <li><strong>联合索引</strong> <ul><li>primary key(id,name):联合主键索引</li> <li>Unique(id,name): 联合唯一索引</li> <li>index(id,name):联合普通索引</li></ul></li></ul> <h1 id="_4-索引的操作"><a href="#_4-索引的操作" class="header-anchor">#</a> 4. 索引的操作</h1> <p>三板斧（理论，实战，总结）</p> <h2 id="_4-1-主键索引"><a href="#_4-1-主键索引" class="header-anchor">#</a> 4.1 主键索引</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 创建的时候添加</span>
<span class="token keyword">Create</span> <span class="token keyword">table</span> t1{
Id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
}
<span class="token keyword">Create</span> <span class="token keyword">table</span> t2{
id <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
}
<span class="token comment"># ----------------</span>
<span class="token comment"># 创建完成之后添加</span>
<span class="token keyword">Alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">add</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 删除索引</span>
<span class="token keyword">Alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">drop</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-2-唯一索引"><a href="#_4-2-唯一索引" class="header-anchor">#</a> 4.2 唯一索引</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">Create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>
Id <span class="token keyword">int</span> <span class="token keyword">unique</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">Create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>
Id <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">Unique</span> <span class="token keyword">key</span> uni_name <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment"># 表创建好之后添加唯一索引:</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> s1 <span class="token keyword">add</span> <span class="token keyword">unique</span> <span class="token keyword">key</span>  u_name<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 删除:</span>
<span class="token keyword">Alter</span> <span class="token keyword">table</span> s1 <span class="token keyword">drop</span> <span class="token keyword">index</span> u_name<span class="token punctuation">;</span>

</code></pre></div><h2 id="_4-3-普通索引"><a href="#_4-3-普通索引" class="header-anchor">#</a> 4.3 普通索引</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token comment"># 普通索引:</span>
<span class="token comment"># 创建:</span>
<span class="token keyword">Create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>
Id <span class="token keyword">int</span><span class="token punctuation">,</span>
<span class="token keyword">Index</span> index_name<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">Alter</span> <span class="token keyword">table</span> s1 <span class="token keyword">add</span> <span class="token keyword">index</span> index_name<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">Create</span> <span class="token keyword">index</span> index_name <span class="token keyword">on</span> s1<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 删除:</span>
<span class="token keyword">Alter</span> <span class="token keyword">table</span> s1 <span class="token keyword">drop</span> <span class="token keyword">index</span> u_name<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> 索引名 <span class="token keyword">ON</span> 表名字<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意事项：创建索引的时候尽量给数据比较小的字段添加索引，树会比较矮。给数据区分度比较高的字段添加索引，二次查找返回会比较小。</p></blockquote> <h2 id="_4-4-使用场景"><a href="#_4-4-使用场景" class="header-anchor">#</a> 4.4 使用场景</h2> <div class="language-tex extra-class"><pre class="language-tex"><code>举个例子来说，比如你在为某商场做一个会员卡的系统。

这个系统有一个会员表
有下列字段：
会员编号 INT
会员姓名 VARCHAR(10)
会员身份证号码 VARCHAR(18)
会员电话 VARCHAR(10)
会员住址 VARCHAR(50)
会员备注信息 TEXT

那么这个 会员编号，作为主键，使用 PRIMARY
会员姓名 如果要建索引的话，那么就是普通的 INDEX
会员身份证号码 如果要建索引的话，那么可以选择 UNIQUE （唯一的，不允许重复）

#除此之外还有全文索引，即FULLTEXT
会员备注信息 ， 如果需要建索引的话，可以选择全文搜索。
用于搜索很长一篇文章的时候，效果最好。
用在比较短的文本，如果就一两行字的，普通的 INDEX 也可以。
但其实对于全文搜索，我们并不会使用MySQL自带的该索引，而是会选择第三方软件如Sphinx，专门来做全文搜索。

#其他的如空间索引SPATIAL，了解即可，几乎不用

抄过来的
</code></pre></div><h2 id="_4-5-索引的类型"><a href="#_4-5-索引的类型" class="header-anchor">#</a> 4.5 索引的类型</h2> <ul><li>Hash 索引： 查询单条快，范围查询慢。</li> <li>Btree索引：层数越多，数据量指数级增长，适合范围查询</li></ul> <p>不同的存储引擎支持的索引类型也不一样</p> <ul><li>InnoDB： 支持事物，支持行级锁定，B-Tree,Full-test</li> <li>MyISAM: 不支持事物，同上</li> <li>Memory: 不支持事物，表级锁定。支持B-tree,hash,不支持full-text.</li> <li>NDB: 支持事物，支持行级锁定。只支持hash</li> <li>Archive: 不支持事物。表级别锁定，不支持三个索引</li></ul> <h1 id="_5-测试索引-实操"><a href="#_5-测试索引-实操" class="header-anchor">#</a> 5. 测试索引-实操</h1> <h2 id="_5-1-准备表"><a href="#_5-1-准备表" class="header-anchor">#</a> 5.1 准备表</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#1. 准备表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> s1<span class="token punctuation">(</span>
id <span class="token keyword">int</span><span class="token punctuation">,</span>
name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
gender <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#2. 创建存储过程，实现批量插入记录</span>
<span class="token keyword">delimiter</span> $$ <span class="token comment">#声明存储过程的结束符号为$$</span>
<span class="token keyword">create</span> <span class="token keyword">procedure</span> auto_insert1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">declare</span> i <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">3000000</span><span class="token punctuation">)</span><span class="token keyword">do</span>
        <span class="token keyword">insert</span> <span class="token keyword">into</span> s1 <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'egon'</span><span class="token punctuation">,</span><span class="token string">'male'</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">'egon'</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">'@oldboy'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>$$ <span class="token comment">#$$结束</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">#重新声明分号为结束符号</span>

<span class="token comment">#3. 查看存储过程</span>
<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">procedure</span> auto_insert1\G 

<span class="token comment">#4. 调用存储过程</span>
<span class="token keyword">call</span> auto_insert1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5-2-普通查询"><a href="#_5-2-普通查询" class="header-anchor">#</a> 5.2 普通查询</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#无索引：mysql根本就不知道到底是否存在id等于333333333的记录，也不知道存在几条id=333333333的记录，只能把数据表从头到尾扫描一遍，此时有多少个磁盘块就需要进行多少IO操作，所以查询速度很慢</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">333333333</span><span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.33</span> sec<span class="token punctuation">)</span>
</code></pre></div><h2 id="_5-3-建立索引"><a href="#_5-3-建立索引" class="header-anchor">#</a> 5.3 建立索引</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> a <span class="token keyword">on</span> s1<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>在表中已经存在大量数据的情况下，建立索引，会非常的慢</p></blockquote> <h2 id="_5-4-索引查询"><a href="#_5-4-索引查询" class="header-anchor">#</a> 5.4 索引查询</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> s1 <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">3333333333</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>很快啊。因为找不到这个主键</p></blockquote> <h2 id="_5-5-总结"><a href="#_5-5-总结" class="header-anchor">#</a> 5.5 总结</h2> <ol><li>要为常用的搜索条件建立索引</li> <li>在表中已有数据的情况下建立索引会很慢，但是会增加查询数据</li> <li>建立索引很降低修改，插入，删除数据的效率。因为需要修改索引结构</li> <li>不要过多的滥用索引，过多的建立索引会将读数据的插入速度，每次插入数据都需要做好一个数据结构，然后写回磁盘，IO飙升。</li></ol> <h1 id="_6-索引命中"><a href="#_6-索引命中" class="header-anchor">#</a> 6 索引命中</h1> <p>真实中并不是建立了索引所有的查询就会加快查询速度，同上的例子，如果用email当作查询条件。速度依然很慢。因为这个查询并没有命中索引。那是不是把where后面的条件加上索引就会直接命中嘞  不一定。情况如下：</p> <h2 id="_1-范围查询"><a href="#_1-范围查询" class="header-anchor">#</a> <strong>1. 范围查询</strong></h2> <p>或者说条件不明确，&gt; , &gt;= , &lt; , &lt;= , != , between , like 等等</p> <ul><li>= ：明确找一个值，可以在索引数中快速找到</li> <li>&gt;： 同样会用到索引数，但是如果查询的范围特别大的话，跟全表扫描差不多</li> <li>&gt; and &lt;: 会用到索引，如果范围小的话，查询速度也很快的</li> <li>!= ： 不等于是一个很大的范围，几乎等同于扫全表</li> <li>between: 会用索引，根据范围来决定速度</li></ul> <h2 id="_2-模糊查询"><a href="#_2-模糊查询" class="header-anchor">#</a> <strong>2. 模糊查询</strong></h2> <p>这个比较特殊了啊</p> <p>案例：先给刚刚的email建立一个索引</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 创建索引</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> d <span class="token keyword">on</span> s1<span class="token punctuation">(</span>email<span class="token punctuation">)</span>

<span class="token comment"># 创建的很慢啊</span>

<span class="token comment"># 完成之后我们查看一下</span>
<span class="token keyword">desc</span> iot_risk_customer

<span class="token operator">+</span><span class="token comment">-------------------+--------------+------+-----+---------+-----------------------------+</span>
<span class="token operator">|</span> Field             <span class="token operator">|</span> <span class="token keyword">Type</span>         <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra                       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+--------------+------+-----+---------+-----------------------------+</span>
<span class="token operator">|</span> id       <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token keyword">auto_increment</span>              <span class="token operator">|</span>
<span class="token operator">|</span> email    <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>           <span class="token operator">|</span> YES  <span class="token operator">|</span> MUL <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+--------------+------+-----+---------+-----------------------------+</span>
<span class="token comment"># key这一列有MUL说明创建成功</span>
</code></pre></div><ul><li>Like: 如果没有通配符，那么跟=是一个效果，精准匹配</li> <li>右边通配符：速度依然很快</li> <li>左边通配符：速度变慢</li></ul> <blockquote><p>因为左边通配符没有用到索引，索引采用最左匹配原则，即树的查找是从左边开始的。</p></blockquote> <h2 id="_3-区分度"><a href="#_3-区分度" class="header-anchor">#</a> 3. 区分度</h2> <p>尽量选择区分度比较高的列作为索引，区分度的公式为<code>count(distinct col)/count(*)</code>,表示字段不重复的比例，比例越大，扫描的记录越少，唯一的区分度是1，而一些字段比如性别，在大数据面前约等于0。一般需要join的字段都要求是0.1，即一条数据扫描十条记录</p> <blockquote><p>区分度也影响到树的高度，对于区分度低的字段，无法找到大小关系，树是按照大小顺序存放的。这些值区分度越低的话那么树越高，如果索引字段都一样的话，那么这跟树几乎成了一根棍。</p></blockquote> <h2 id="_4-和in"><a href="#_4-和in" class="header-anchor">#</a> 4.= 和in</h2> <p>可以乱序，比如 <code>a = 1 and b = 2 and c = 3</code> 建立(a,b,c）索引可以任意顺序，因为索引优化器会优化。</p> <ol><li>索引列不能参与计算。保持列干净，<strong>比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’)</strong></li></ol> <h2 id="_5-and-or"><a href="#_5-and-or" class="header-anchor">#</a> 5. And\or</h2> <h3 id="_5-1-and"><a href="#_5-1-and" class="header-anchor">#</a> 5.1 and</h3> <p>所有条件成立则最终结果成立</p> <ul><li>条件：        a = 10 and b = 'xxx' and c &gt; 3 and d =4</li> <li>索引：        制作联合索引(d,a,b,c)</li></ul> <p>Mysql 索引的本质原理就是不断的缩小查询范围，对于多个and。mysql会按照从左到右找一个区分度表高的数据，这样可以最快的缩小范围，加速查询即按照d—&gt;a-&gt;b-&gt;c的顺序。</p> <p>先找区别度高的列查询</p> <h3 id="_5-2-or"><a href="#_5-2-or" class="header-anchor">#</a> 5.2 or</h3> <p>只要有一个条件成立，那么结果就成立</p> <ul><li>条件：        a = 10 or b = 'xxx' or c &gt; 3 or d =4</li> <li>索引：        制作联合索引(d,a,b,c)</li></ul> <p>只要有一个匹配成功就行，所以对于连续多个，会按照查询顺序来判断 即 a-&gt;b-&gt;c-&gt;d</p> <h2 id="_6-最左匹配"><a href="#_6-最左匹配" class="header-anchor">#</a> 6. 最左匹配</h2> <p><strong>最左前缀匹配原则（详见第八小节），非常重要的原则，对于组合索引mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配(指的是范围大了，有索引速度也慢)，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</strong></p> <h2 id="_7-其他情况"><a href="#_7-其他情况" class="header-anchor">#</a> 7. 其他情况</h2> <ul><li><p>使用函数：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb1 <span class="token keyword">where</span> reverse<span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'egon'</span><span class="token punctuation">;</span>
<span class="token comment"># 不走索引 要保持干净</span>
</code></pre></div></li> <li><p>类型不一致</p> <div class="language-sql extra-class"><pre class="language-sql"><code>如果列是字符串类型，传入条件是必须用引号引起来，不然<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb1 <span class="token keyword">where</span> email <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>排序</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> name <span class="token keyword">from</span> s1 <span class="token keyword">order</span> <span class="token keyword">by</span> email <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token comment"># 当根据索引排序的时候，select查询的字段必须也是索引字段</span>
<span class="token comment"># 需要按照email索引的顺序查询，然后去主键索引查询，性能不佳</span>
</code></pre></div><blockquote><p>主键排序除外，因为主键的叶子节点上存的是整条数据</p></blockquote></li></ul> <p>其他注意事项</p> <div class="language- extra-class"><pre class="language-text"><code>- 避免使用select *
- count(1)或count(列) 代替 count(*)
- 创建表时尽量时 char 代替 varchar
- 表的字段顺序固定长度的字段优先
- 组合索引代替多个单列索引（经常使用多个条件查询时）
- 尽量使用短索引
- 使用连接（JOIN）来代替子查询(Sub-Queries)
- 连表时注意条件类型需一致
- 索引散列值（重复少）不适合建索引，例：性别不适合
</code></pre></div><h1 id="_7-联合索引-覆盖索引"><a href="#_7-联合索引-覆盖索引" class="header-anchor">#</a> 7.联合索引&amp;&amp;覆盖索引</h1> <h2 id="_7-1-联合索引"><a href="#_7-1-联合索引" class="header-anchor">#</a> 7.1 联合索引</h2> <p>对表上的多个列联合起来做一个索引，如果查询条件列一直在变，则需要组合索引。</p> <p>注意索引最左匹配：区分度高的列放在前面，范围查询放在后面。</p> <p>联合索引自动排序：在第一个键相同的情况下，会自动对第二个键进行排序处理</p> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token comment">#对于联合索引（a,b）,下述语句可以直接使用该索引，无需二次排序</span>
<span class="token keyword">select</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> a<span class="token operator">=</span>xxx <span class="token keyword">order</span> <span class="token keyword">by</span> b<span class="token punctuation">;</span>

<span class="token comment">#然后对于联合索引(a,b,c)来首，下列语句同样可以直接通过索引得到结果</span>
<span class="token keyword">select</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> a<span class="token operator">=</span>xxx <span class="token keyword">order</span> <span class="token keyword">by</span> b<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> a<span class="token operator">=</span>xxx <span class="token operator">and</span> b<span class="token operator">=</span>xxx <span class="token keyword">order</span> <span class="token keyword">by</span> c<span class="token punctuation">;</span>

<span class="token comment">#但是对于联合索引(a,b,c)，下列语句不能通过索引直接得到结果，还需要自己执行一次filesort操作，因为索引（a，c)并未排序</span>
</code></pre></div><h2 id="_7-2-覆盖索引"><a href="#_7-2-覆盖索引" class="header-anchor">#</a> 7.2 覆盖索引</h2> <p><strong>InnoDB存储引擎支持覆盖索引（covering index，或称索引覆盖），即从辅助索引中就可以得到查询记录，而不需要查询聚集索引中的记录。</strong></p> <p><strong>使用覆盖索引的一个好处是：辅助索引不包含整行记录的所有信息，故其大小要远小于聚集索引，因此可以减少大量的IO操作</strong></p> <h1 id="_8-优化-explain"><a href="#_8-优化-explain" class="header-anchor">#</a> 8 优化-explain</h1> <p><strong>关于explain命令相信大家并不陌生，具体用法和字段含义可以参考官网explain-output，这里需要强调rows是核心指标，绝大部分rows小的语句执行一定很快（有例外，下面会讲到）。所以优化语句基本上都是在优化rows。</strong></p> <div class="language- extra-class"><pre class="language-text"><code>执行计划：让mysql预估执行操作(一般正确)
    all &lt; index &lt; range &lt; index_merge &lt; ref_or_null &lt; ref &lt; eq_ref &lt; system/const
    id,email
    
    慢：
        select * from userinfo3 where name='alex'
        
        explain select * from userinfo3 where name='alex'
        type: ALL(全表扫描)
            select * from userinfo3 limit 1;
    快：
        select * from userinfo3 where email='alex'
        type: const(走索引)
</code></pre></div><h1 id="_9-万能优化法"><a href="#_9-万能优化法" class="header-anchor">#</a> 9 万能优化法</h1> <p>这次来点狠的</p> <p>开启trace 来追踪</p> <p><strong>1. 查看优化器的状态</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'optimizer_trace'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+--------------------------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+--------------------------+</span>
<span class="token operator">|</span> optimizer_trace <span class="token operator">|</span> enabled<span class="token operator">=</span><span class="token keyword">off</span><span class="token punctuation">,</span>one_line<span class="token operator">=</span><span class="token keyword">off</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+--------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>
</code></pre></div><p><strong>2.会话级别临时开启</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">session</span> optimizer_trace<span class="token operator">=</span><span class="token string">&quot;enabled=on&quot;</span><span class="token punctuation">,</span>end_markers_in_json<span class="token operator">=</span><span class="token keyword">on</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>3.<strong>设置优化器追踪的内存大小</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> OPTIMIZER_TRACE_MAX_MEM_SIZE<span class="token operator">=</span><span class="token number">1000000</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 注意：不设置优化器最大容量的话，可能会导致优化器返回的结果不全。</span>
</code></pre></div><p><strong>4.执行自己的sql</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>customer_name<span class="token punctuation">,</span>a<span class="token punctuation">.</span>project_id<span class="token punctuation">,</span>b<span class="token punctuation">.</span>case_name <span class="token keyword">FROM</span> iot_risk_customer A <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> adm_iot_riskcontrol_case_customer_dd B <span class="token keyword">on</span> a<span class="token punctuation">.</span>project_id <span class="token operator">=</span> b<span class="token punctuation">.</span>case_id <span class="token keyword">limit</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>5.information_schema.optimizer_trace表</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> trace <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>OPTIMIZER_TRACE<span class="token punctuation">;</span>
</code></pre></div><p>导入到一个命名为xx.trace的文件，然后用JSON阅读器来查看</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> TRACE <span class="token keyword">INTO</span> <span class="token keyword">DUMPFILE</span> <span class="token string">&quot;E:\\test.trace&quot;</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>OPTIMIZER_TRACE<span class="token punctuation">;</span>
<span class="token comment"># 如果没有控制台权限，或直接交由运维，让他把该 trace 文件，输出给你就行了。</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>{
  &quot;steps&quot;: [
    {
      &quot;join_preparation&quot;: { //准备阶段，包查询语句转换
        &quot;select#&quot;: 1,
        &quot;steps&quot;: [
          {
            &quot;expanded_query&quot;: &quot;/* select#1 */ select `a`.`customer_name` AS `customer_name`,`a`.`project_id` AS `project_id`,`b`.`case_name` AS `case_name` from (`iot_risk_customer` `a` left join `adm_iot_riskcontrol_case_customer_dd` `b` on((`a`.`project_id` = `b`.`case_id`))) limit 1000&quot;
          },
          {
            &quot;transformations_to_nested_joins&quot;: {
              &quot;transformations&quot;: [
                &quot;parenthesis_removal&quot;
              ] ,
              &quot;expanded_query&quot;: &quot;/* select#1 */ select `a`.`customer_name` AS `customer_name`,`a`.`project_id` AS `project_id`,`b`.`case_name` AS `case_name` from `iot_risk_customer` `a` left join `adm_iot_riskcontrol_case_customer_dd` `b` on((`a`.`project_id` = `b`.`case_id`)) limit 1000&quot;
            } 
          }
        ] 
      } 
    },
    {
      &quot;join_optimization&quot;: { //优化阶段，包括以下主要阶段
        &quot;select#&quot;: 1,
        &quot;steps&quot;: [
          {
            &quot;condition_processing&quot;: { //处理where条件部分，主要包括等式处理、常量处理、多余条件处理
              &quot;condition&quot;: &quot;WHERE&quot;,
              &quot;original_condition&quot;: null,
              &quot;steps&quot;: [
                {
                  &quot;transformation&quot;: &quot;equality_propagation&quot;,
                  &quot;resulting_condition&quot;: null
                }
              ] 
            } 
          },
          {
            &quot;table_dependencies&quot;: [ //表依赖检查
              {
                &quot;table&quot;: &quot;`iot_risk_customer` `a`&quot;,
                &quot;row_may_be_null&quot;: false,
                &quot;map_bit&quot;: 0,
                &quot;depends_on_map_bits&quot;: [
                ] 
              },
              {
                &quot;table&quot;: &quot;`adm_iot_riskcontrol_case_customer_dd` `b`&quot;,
                &quot;row_may_be_null&quot;: true,
                &quot;map_bit&quot;: 1,
                &quot;depends_on_map_bits&quot;: [
                  0
                ] 
              }
            ]
          },
          {
            &quot;ref_optimizer_key_uses&quot;: [ //评估可用的索引
              {
                &quot;table&quot;: &quot;`adm_iot_riskcontrol_case_customer_dd` `b`&quot;,
                &quot;field&quot;: &quot;case_id&quot;, //可以用的索引
                &quot;equals&quot;: &quot;`a`.`project_id`&quot;,
                &quot;null_rejecting&quot;: true
              }
            ] 
          },
          {
            &quot;rows_estimation&quot;: [ //评估访问单表的方式，及扫描的行数与代价
              {
                &quot;table&quot;: &quot;`iot_risk_customer` `a`&quot;,
                &quot;table_scan&quot;: {
                  &quot;rows&quot;: 144672, //需要扫描的行数
                  &quot;cost&quot;: 6508  //可以看作查询需要6秒
                } 
              },
              {
                &quot;table&quot;: &quot;`adm_iot_riskcontrol_case_customer_dd` `b`&quot;,
                &quot;table_scan&quot;: {
                  &quot;rows&quot;: 95, //需要扫描的行数
                  &quot;cost&quot;: 1 //忽略不计
                } 
              }
            ] 
          },
          {
            &quot;considered_execution_plans&quot;: [ //评估最终可使用的执行计划
              {
                &quot;plan_prefix&quot;: [
                ] ,
                &quot;table&quot;: &quot;`iot_risk_customer` `a`&quot;,
                &quot;best_access_path&quot;: {
                  &quot;considered_access_paths&quot;: [
                    {
                      &quot;rows_to_scan&quot;: 144672,
                      &quot;access_type&quot;: &quot;scan&quot;,
                      &quot;resulting_rows&quot;: 144672,
                      &quot;cost&quot;: 35442,
                      &quot;chosen&quot;: true
                    }
                  ] 
                } ,
                &quot;condition_filtering_pct&quot;: 100,
                &quot;rows_for_plan&quot;: 144672,
                &quot;cost_for_plan&quot;: 35442,
                &quot;rest_of_plan&quot;: [
                  {
                    &quot;plan_prefix&quot;: [
                      &quot;`iot_risk_customer` `a`&quot;
                    ] ,
                    &quot;table&quot;: &quot;`adm_iot_riskcontrol_case_customer_dd` `b`&quot;,
                    &quot;best_access_path&quot;: {
                      &quot;considered_access_paths&quot;: [
                        {
                          &quot;access_type&quot;: &quot;eq_ref&quot;,
                          &quot;index&quot;: &quot;PRIMARY&quot;,
                          &quot;rows&quot;: 1,
                          &quot;cost&quot;: 173606,
                          &quot;chosen&quot;: true,
                          &quot;cause&quot;: &quot;clustered_pk_chosen_by_heuristics&quot;
                        },
                        {
                          &quot;rows_to_scan&quot;: 95,
                          &quot;access_type&quot;: &quot;scan&quot;,
                          &quot;using_join_cache&quot;: true,
                          &quot;buffers_needed&quot;: 164,
                          &quot;resulting_rows&quot;: 95,
                          &quot;cost&quot;: 2.75e6,
                          &quot;chosen&quot;: false
                        }
                      ] 
                    } ,
                    &quot;condition_filtering_pct&quot;: 100,
                    &quot;rows_for_plan&quot;: 144672,
                    &quot;cost_for_plan&quot;: 209049,
                    &quot;chosen&quot;: true
                  }
                ]
              }
            ] 
          },
          {
            &quot;condition_on_constant_tables&quot;: &quot;1&quot;,
            &quot;condition_value&quot;: true
          },
          {
            &quot;attaching_conditions_to_tables&quot;: {
              &quot;original_condition&quot;: &quot;1&quot;,
              &quot;attached_conditions_computation&quot;: [
              ] ,
              &quot;attached_conditions_summary&quot;: [
                {
                  &quot;table&quot;: &quot;`iot_risk_customer` `a`&quot;,
                  &quot;attached&quot;: null
                },
                {
                  &quot;table&quot;: &quot;`adm_iot_riskcontrol_case_customer_dd` `b`&quot;,
                  &quot;attached&quot;: &quot;&lt;if&gt;(is_not_null_compl(B), (`a`.`project_id` = `b`.`case_id`), true)&quot;
                }
              ] 
            } 
          },
          {
            &quot;refine_plan&quot;: [
              {
                &quot;table&quot;: &quot;`iot_risk_customer` `a`&quot;
              },
              {
                &quot;table&quot;: &quot;`adm_iot_riskcontrol_case_customer_dd` `b`&quot;
              }
            ] 
          }
        ] 
      } 
    },
    {
      &quot;join_execution&quot;: {
        &quot;select#&quot;: 1,
        &quot;steps&quot;: [
        ] 
      }
    }
  ]
}
</code></pre></div><p>主要关注</p> <div class="language-json extra-class"><pre class="language-json"><code> <span class="token punctuation">{</span>
            <span class="token property">&quot;rows_estimation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//评估访问单表的方式，及扫描的行数与代价</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`iot_risk_customer` `a`&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;table_scan&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token property">&quot;rows&quot;</span><span class="token operator">:</span> <span class="token number">144672</span><span class="token punctuation">,</span> <span class="token comment">//需要扫描的行数</span>
                  <span class="token property">&quot;cost&quot;</span><span class="token operator">:</span> <span class="token number">6508</span>  <span class="token comment">//可以看作查询需要6秒</span>
                <span class="token punctuation">}</span> 
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">&quot;table&quot;</span><span class="token operator">:</span> <span class="token string">&quot;`adm_iot_riskcontrol_case_customer_dd` `b`&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;table_scan&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token property">&quot;rows&quot;</span><span class="token operator">:</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token comment">//需要扫描的行数</span>
                  <span class="token property">&quot;cost&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token comment">//忽略不计</span>
                <span class="token punctuation">}</span> 
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span> 
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>以上优化器的主要步骤：</p> <ol><li>join_preparation ：准备阶段，包查询语句转换，转换成嵌套循环语句等</li></ol> <p>expanded_query</p> <p>transformations_to_nested_joins</p> <ol start="2"><li>join_optimization ：优化阶段，包括以下主要阶段</li></ol> <p>condition_processing ：处理where条件部分，主要包括等式处理、常量处理、多余条件处理</p> <p>table_dependencies ：表依赖检查</p> <p>ref_optimizer_key_uses ：评估可用的索引</p> <p>rows_estimation    ：评估访问单表的方式，及扫描的行数与代价</p> <p>considered_execution_plans ：评估最终可使用的执行计划</p> <p>condition_on_constant_tables :检查带常量表的条件</p> <p>attaching_conditions_to_tables ：将常量条件作用到表</p> <p>refine_plan 改进计划，不理解</p> <ol start="3"><li>join_execution ：执行阶段</li></ol> <p>神奇的B+树</p> <p><img src="https://mrtao-bucket.oss-cn-shanghai.aliyuncs.com/1618905597834-B%2B%E6%A0%91.png" alt=""></p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f54a37/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">锁-事物</div></a> <a href="/pages/e1aa05/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">学习笔记</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/f54a37/" class="prev">锁-事物</a></span> <span class="next"><a href="/pages/e1aa05/">学习笔记</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/4e0768/"><div>
            Swagger接入YApi
            <!----></div></a> <span class="date">06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ceaa10/"><div>
            Docker_学习笔记2
            <!----></div></a> <span class="date">05-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/7bf273/"><div>
            压缩网络图片并下载
            <!----></div></a> <span class="date">05-31</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.98d20b3f.js" defer></script><script src="/assets/js/2.869fa79d.js" defer></script><script src="/assets/js/19.31ae385d.js" defer></script>
  </body>
</html>
